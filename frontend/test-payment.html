<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>支付测试</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>支付测试页面</h1>
    <div id="app">
        <button onclick="testPaymentMethods()">测试获取支付方式</button>
        <button onclick="testCreateOrder()">测试创建订单</button>
        <button onclick="testCreatePayment()">测试创建支付</button>
        <div id="result"></div>
    </div>

    <script>
        const api = axios.create({
            baseURL: '/api/v1',
            timeout: 10000,
            headers: {
                'Content-Type': 'application/json'
            }
        });

        // 添加token
        const token = localStorage.getItem('token');
        if (token) {
            api.defaults.headers.Authorization = `Bearer ${token}`;
        }

        async function testPaymentMethods() {
            try {
                const response = await api.get('/payment/methods');
                document.getElementById('result').innerHTML = '<pre>' + JSON.stringify(response.data, null, 2) + '</pre>';
            } catch (error) {
                document.getElementById('result').innerHTML = '<pre>错误: ' + error.message + '</pre>';
            }
        }

        async function testCreateOrder() {
            try {
                const orderData = {
                    package_id: 1,
                    amount: 19.9,
                    payment_method: 'alipay'
                };
                const response = await api.post('/orders/create', orderData);
                document.getElementById('result').innerHTML = '<pre>' + JSON.stringify(response.data, null, 2) + '</pre>';
            } catch (error) {
                document.getElementById('result').innerHTML = '<pre>错误: ' + error.message + '</pre>';
            }
        }

        async function testCreatePayment() {
            try {
                const paymentData = {
                    order_no: 'XB17572923521340',
                    amount: 19.9,
                    currency: 'CNY',
                    payment_method: 'alipay',
                    subject: '订阅套餐 - 基础套餐',
                    body: '购买30天订阅套餐'
                };
                const response = await api.post('/payment/create', paymentData);
                document.getElementById('result').innerHTML = '<pre>' + JSON.stringify(response.data, null, 2) + '</pre>';
            } catch (error) {
                document.getElementById('result').innerHTML = '<pre>错误: ' + error.message + '</pre>';
            }
        }
    </script>
</body>
</html>
