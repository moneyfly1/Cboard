<!DOCTYPE html>
<html>
<head>
    <title>API测试页面</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        button { margin: 5px; padding: 10px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
    </style>
</head>
<body>
    <h1>XBoard API测试页面</h1>
    
    <div>
        <button onclick="testLogin()">1. 测试登录</button>
        <button onclick="testUsers()">2. 测试用户列表</button>
        <button onclick="clearResults()">清除结果</button>
    </div>
    
    <div id="result"></div>

    <script>
        const api = axios.create({
            baseURL: '/api/v1',
            timeout: 10000
        });

        let token = '';

        function showResult(title, content, isSuccess = true) {
            const resultDiv = document.getElementById('result');
            const div = document.createElement('div');
            div.className = `result ${isSuccess ? 'success' : 'error'}`;
            div.innerHTML = `<h3>${title}</h3><pre>${JSON.stringify(content, null, 2)}</pre>`;
            resultDiv.appendChild(div);
        }

        async function testLogin() {
            try {
                showResult('开始登录测试', '正在登录...', true);
                
                const response = await api.post('/auth/login-json', {
                    username: 'admin',
                    password: 'admin123'
                });
                
                token = response.data.access_token;
                showResult('登录成功', response.data, true);
                
                // 显示用户信息
                const user = response.data.user;
                showResult('用户信息', {
                    id: user.id,
                    username: user.username,
                    email: user.email,
                    is_admin: user.is_admin,
                    is_active: user.is_active
                }, true);
                
            } catch (error) {
                showResult('登录失败', {
                    message: error.message,
                    response: error.response?.data
                }, false);
            }
        }

        async function testUsers() {
            if (!token) {
                showResult('错误', '请先登录获取token', false);
                return;
            }

            try {
                showResult('开始测试用户列表API', '正在获取用户列表...', true);
                
                const response = await api.get('/admin/users', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    params: {
                        page: 1,
                        size: 10
                    }
                });
                
                const data = response.data;
                showResult('用户列表API成功', {
                    success: data.success,
                    message: data.message,
                    total: data.data?.total,
                    users_count: data.data?.users?.length || 0,
                    first_user: data.data?.users?.[0] || null,
                    page: data.data?.page,
                    size: data.data?.size
                }, true);
                
                // 显示前3个用户
                if (data.data?.users && data.data.users.length > 0) {
                    const users = data.data.users.slice(0, 3);
                    showResult('前3个用户', users, true);
                }
                
            } catch (error) {
                showResult('用户列表API失败', {
                    message: error.message,
                    status: error.response?.status,
                    response: error.response?.data
                }, false);
            }
        }

        function clearResults() {
            document.getElementById('result').innerHTML = '';
        }
    </script>
</body>
</html>
